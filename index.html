<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Era Birthday Quest — Fixed</title>
  <style>
    :root{
      --bg:#0f172a; --card:#0b1220; --text:#f8fafc; --glass: rgba(255,255,255,0.04); --accent:#ff758f;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    *{box-sizing:border-box}
    body{margin:0; min-height:100vh; background:linear-gradient(180deg,#071020 0%, #0b1530 100%); color:var(--text); display:flex; align-items:center; justify-content:center; padding:32px}
    .app{width:960px; max-width:96vw; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.08)); border-radius:14px; padding:22px; box-shadow:0 8px 30px rgba(2,6,23,0.7);}
    header{display:flex; align-items:center; gap:16px}
    h1{margin:0; font-size:22px}
    .subtitle{color:rgba(255,255,255,0.7); font-size:13px}

    .era-grid{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:18px}
    .era-card{background:var(--glass); border-radius:12px; padding:14px; cursor:pointer; transition:transform .18s ease, box-shadow .18s ease; border:1px solid rgba(255,255,255,0.03)}
    .era-card:hover{transform:translateY(-6px); box-shadow:0 8px 24px rgba(0,0,0,0.5)}
    .era-title{font-weight:700; font-size:16px}
    .era-desc{font-size:13px; color:rgba(255,255,255,0.8)}

    .play-area{margin-top:18px; display:flex; gap:16px}
    .panel{flex:1; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:14px; border-radius:10px; min-height:320px}

    .hud{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .progress{height:12px; background:rgba(255,255,255,0.06); border-radius:999px; overflow:hidden}
    .progress > i{display:block; height:100%; width:0%; background:linear-gradient(90deg,var(--accent), #ffd1e0)}

    .items-area{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px}
    .item{width:88px; height:88px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:32px; cursor:pointer; user-select:none; transition:transform .12s ease; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03)}
    .item:hover{transform:translateY(-6px)}

    .controls{display:flex; gap:8px; margin-top:12px}
    button{background:transparent; border:1px solid rgba(255,255,255,0.06); padding:8px 12px; border-radius:8px; color:var(--text); cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent), #ffd1e0); color:#1a1a1a; border:none}

    .hidden{display:none}

    /* final screen */
    .final-screen{display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px; text-align:center}
    .big-heart{font-size:96px; animation:pop .9s ease forwards}
    @keyframes pop{0%{transform:scale(.2); opacity:0}70%{transform:scale(1.12); opacity:1}100%{transform:scale(1);} }

    .confetti-canvas{position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none}

    footer{margin-top:14px; color:rgba(255,255,255,0.6); font-size:13px}

    @media (max-width:860px){.era-grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:560px){.era-grid{grid-template-columns:repeat(1,1fr)} .play-area{flex-direction:column}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Era Birthday Quest</h1>
        <div class="subtitle">Click through the eras, collect items, and unlock your birthday surprise.</div>
      </div>
      <div style="margin-left:auto; text-align:right">
        <div style="font-weight:700">For: <span id="recipientName">Her</span></div>
        <div style="font-size:12px; color:rgba(255,255,255,0.7)">Completed: <span id="completedCount">0</span>/<span id="eraCount">0</span> eras</div>
      </div>
    </header>

    <div class="era-grid" id="eraGrid" aria-live="polite"></div>

    <div class="play-area">
      <div class="panel" id="leftPanel">
        <div class="hud">
          <div>
            <div style="font-weight:700" id="currentEraTitle">Select an era to begin</div>
            <div style="font-size:13px; color:rgba(255,255,255,0.7)" id="currentEraDesc">Each era has a set of items to collect. Click them to progress.</div>
          </div>
          <div style="width:48%">
            <div style="font-size:12px; color:rgba(255,255,255,0.7)">Progress</div>
            <div class="progress"><i id="progBar"></i></div>
          </div>
        </div>

        <div id="eraIntro" style="margin-top:12px">
          <h2 id="introTitle">Pick an era</h2>
          <p id="introDesc">Each era has 3 questions. Answer them to complete the era.</p>
        </div>

        <div class="items-area" id="itemsArea" style="margin-top:12px">
          <div style="color:rgba(255,255,255,0.5); width:100%">Pick an era from above to start collecting.</div>
        </div>

        <div id="questionSection" class="hidden" style="margin-top:12px">
          <div class="question-area">
            <div class="question-title" id="questionText"></div>
            <ul class="choices" id="choicesList"></ul>
          </div>
        </div>

        <div class="controls">
          <button id="resetBtn">Reset Era</button>
          <button id="randomBtn">Surprise Era</button>
          <button class="primary" id="revealBtn">Reveal Surprise</button>
          <button id="nextQuestionBtn" class="primary hidden">Next Question</button>
        </div>

      </div>

      <div class="panel" id="rightPanel">
        <div id="sideContent">
          <h3 style="margin:8px 0 6px 0">Your Journey</h3>
          <div id="collectedList" style="font-size:14px; color:rgba(255,255,255,0.9)">No items collected yet.</div>
          <h3 style="margin-top:12px">Your Progress</h3>
          <div id="statusList">No eras completed yet.</div>
        </div>

        <div id="finalReveal" class="hidden" style="margin-top:20px">
          <div class="final-screen">
            <div class="big-heart">💖</div>
            <h2 id="finalMessageTitle">Happy Birthday!</h2>
            <p id="finalMessageText" style="max-width:420px; color:rgba(255,255,255,0.9)"></p>
            <button id="restartBtn" class="primary">Play Again</button>
          </div>
        </div>

      </div>
    </div>

    <footer>Tip: customize the recipient name and final message inside <code>script</code> to personalize.</footer>
  </div>

  <canvas class="confetti-canvas" id="confetti"></canvas>

  <script>
    // ---------- CONFIG ----------
    const recipient = { name: 'Your Love' };
    const finalMessage = `Happy Birthday, my star ✨\nI'm so proud of you — your voice, your laugh, your stage. Love you more than all the eras.`;

    const ERAS = [
      { id: 'lover', title: 'Lover', desc: 'Pastel hearts & glitter', color: '#ff9fb1', items: ['💖','🌈','🎀'], questions: [
        { text: 'Which song contains the lyric “I’ve loved you three summers now, honey, I want ’em all”?', choices: ['Cornelia Street','Lover','Paper Rings','Cruel Summer'], correct: 0 },
        { text: 'Which song is NOT on the “Lover” album?', choices: ['Daylight','Death by a Thousand Cuts','Getaway Car','London Boy'], correct: 2 },
        { text: 'On “Lover”, Taylor refers to which street in a lyric?', choices: ['Cornelia Street','London Boy','Miss Americana & the Heartbreak Prince','Soon You’ll Get Better'], correct: 0 }
      ]},
      { id: 'fearless', title: 'Fearless', desc: 'Golden romance & youth', color: '#ffd27f', items: ['✨','🎤','🌟'], questions: [
        { text: 'Which song is the title track of the “Fearless” album?', choices: ['Fearless','Love Story','White Horse','Fifteen'], correct: 0 },
        { text: '“You Belong With Me” was released on which album?', choices: ['Fearless','Speak Now','Red','1989'], correct: 0 },
        { text: 'Which song from “Fearless” won a Grammy for Best Female Country Vocal Performance?', choices: ['White Horse','You Belong with Me','Mine','Fifteen'], correct: 1 }
      ]},
      { id: 'red', title: 'Red', desc: 'Scarves, heartbreak & poetry', color: '#d33f49', items: ['🧣','💌','🍷'], questions: [
        { text: 'Which feature artist appears in “Everything Has Changed” on Red?', choices: ['Ed Sheeran','Bon Iver','Kendrick Lamar','Brendon Urie'], correct: 0 },
        { text: 'Which of these songs is NOT on Red?', choices: ['Red','All Too Well','State of Grace','Style'], correct: 3 },
        { text: '“We are too busy dancing to get knocked off our feet” is a lyric from which Red song?', choices: ['Red','22','Everything Has Changed','Stay Stay Stay'], correct: 3 }
      ]},
      { id: 'nineteen', title: '1989', desc: 'Retro synth & city lights', color: '#9bd3ff', items: ['📸','🕶️','🎧'], questions: [
        { text: 'Which of these songs is not on the original “1989” release?', choices: ['Shake It Off','Blank Space','Wildest Dreams','Style','Lover'], correct: 4 },
        { text: 'Which song’s video features Taylor swinging on an ornament and riding a rollercoaster?', choices: ['Out of the Woods','Welcome to New York','Style','Shake It Off'], correct: 0 },
        { text: 'Which producer worked heavily on 1989 (pop sound)?', choices: ['Jack Antonoff','Max Martin','Nate Ruess','Kendrick Lamar'], correct: 1 }
      ]},
      { id: 'folklore', title: 'Folklore', desc: 'Woodsy tales & soft melodies', color: '#c7dcb6', items: ['🍂','📜','🪵'], questions: [
        { text: 'Which song opens the folklore album?', choices: ['the 1','cardigan','exile','august'], correct: 0 },
        { text: 'Which track features Bon Iver on folklore?', choices: ['exile','peace','seven','betty'], correct: 0 },
        { text: 'Which folklore song uses the line “I’ve been the archer, I’ve been the prey”?', choices: ['the last great American dynasty','my tears ricochet','the archer','invisible string'], correct: 2 }
      ]},
      { id: 'midnights', title: 'Midnights', desc: 'Sparkly nights & secret thoughts', color: '#7a6cff', items: ['🌌','🕰️','🌙'], questions: [
        { text: 'Which song contains the lyric “I should’ve stayed, stayed, stayed”?', choices: ['Anti-Hero','Maroon','Snow on the Beach','Karma'], correct: 0 },
        { text: 'Which track features Lana Del Rey on Midnights?', choices: ['Bejeweled','Snow on the Beach','Lavender Haze','Vigilante Shit'], correct: 1 },
        { text: 'Midnights is described as a concept album about how many sleepless nights?', choices: ['5','13','20','8'], correct: 1 }
      ]}
    ];

    // ---------- STATE ----------
    const state = {
      currentEra: null,
      collected: {}, // eraId -> Set
      currentQIndex: 0,
      completed: new Set()
    };

    // ---------- DOM refs ----------
    const eraGrid = document.getElementById('eraGrid');
    const itemsArea = document.getElementById('itemsArea');
    const currentEraTitle = document.getElementById('currentEraTitle');
    const currentEraDesc = document.getElementById('currentEraDesc');
    const progBar = document.getElementById('progBar');
    const collectedList = document.getElementById('collectedList');
    const recipientNameEl = document.getElementById('recipientName');
    const completedCountEl = document.getElementById('completedCount');
    const eraCountEl = document.getElementById('eraCount');
    const statusListEl = document.getElementById('statusList');
    const questionSection = document.getElementById('questionSection');
    const eraIntro = document.getElementById('eraIntro');
    const questionTextEl = document.getElementById('questionText');
    const choicesListEl = document.getElementById('choicesList');
    const nextQuestionBtn = document.getElementById('nextQuestionBtn');
    const revealBtn = document.getElementById('revealBtn');
    const finalReveal = document.getElementById('finalReveal');
    const finalMessageText = document.getElementById('finalMessageText');
    const finalMessageTitle = document.getElementById('finalMessageTitle');
    const restartBtn = document.getElementById('restartBtn');
    const confettiCanvas = document.getElementById('confetti');
    const ctx = confettiCanvas.getContext ? confettiCanvas.getContext('2d') : null;

    recipientNameEl.textContent = recipient.name;
    eraCountEl.textContent = ERAS.length;

    // ---------- UI builders ----------
    function buildEraCards(){
      eraGrid.innerHTML = '';
      ERAS.forEach(e => {
        const card = document.createElement('div');
        card.className = 'era-card';
        card.innerHTML = `<div class="era-title">${e.title}</div><div class="era-desc">${e.desc}</div>`;
        card.style.borderLeft = `6px solid ${e.color}`;
        card.addEventListener('click', () => { if(!state.completed.has(e.id)) selectEra(e.id); });
        eraGrid.appendChild(card);
      });
    }

    function selectEra(eraId){
      const era = ERAS.find(x=>x.id===eraId);
      if(!era) return;
      state.currentEra = era;
      if(!state.collected[era.id]) state.collected[era.id] = new Set();
      state.currentQIndex = 0;
      currentEraTitle.textContent = era.title;
      currentEraDesc.textContent = era.desc;
      renderItems(era);
      updateHUD();
      eraIntro.classList.add('hidden');
      questionSection.classList.remove('hidden');
      nextQuestionBtn.classList.add('hidden');
      revealBtn.classList.remove('hidden');
      loadQuestion();
    }

    function renderItems(era){
      itemsArea.innerHTML = '';
      era.items.forEach(it => {
        const div = document.createElement('div');
        div.className = 'item';
        div.textContent = it;
        if(state.collected[era.id] && state.collected[era.id].has(it)){
          div.style.opacity = '0.4'; div.style.transform='scale(.96)';
        }
        div.addEventListener('click', ()=>collectItem(era, it, div));
        itemsArea.appendChild(div);
      });
    }

    function loadQuestion(){
      const era = state.currentEra;
      if(!era) return;
      const q = era.questions[state.currentQIndex];
      questionTextEl.textContent = q.text;
      choicesListEl.innerHTML = '';
      q.choices.forEach((c, idx)=>{
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.textContent = c;
        btn.addEventListener('click', ()=>handleChoice(idx, btn));
        li.appendChild(btn);
        choicesListEl.appendChild(li);
      });
    }

    function handleChoice(choiceIdx, btn){
      const era = state.currentEra;
      if(!era) return;
      const q = era.questions[state.currentQIndex];
      // disable buttons
      Array.from(choicesListEl.querySelectorAll('button')).forEach(b=>b.disabled=true);
      if(choiceIdx === q.correct){
        btn.classList.add('correct');
        if(state.currentQIndex < era.questions.length - 1){
          nextQuestionBtn.classList.remove('hidden');
          revealBtn.classList.add('hidden');
        } else {
          // last question correct
          state.completed.add(era.id);
          completedCountEl.textContent = state.completed.size;
          revealBtn.textContent = 'Continue →';
        }
      } else {
        btn.classList.add('wrong');
      }
      updateStatus();
    }

    function collectItem(era, item, el){
      if(!state.collected[era.id]) state.collected[era.id] = new Set();
      if(state.collected[era.id].has(item)) return;
      state.collected[era.id].add(item);
      el.animate([{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:220,easing:'ease-out'});
      el.style.opacity='0.4'; el.style.transform='scale(.96)';
      updateHUD();
      if(state.collected[era.id].size === era.items.length){
        state.completed.add(era.id);
        completedCountEl.textContent = state.completed.size;
        confettiBurst(24, era.color);
      }
      if(state.completed.size === ERAS.length) showFinal();
    }

    function updateHUD(){
      const era = state.currentEra;
      if(!era){ progBar.style.width = '0%'; collectedList.innerHTML = 'No items collected yet.'; return; }
      const have = state.collected[era.id] ? state.collected[era.id].size : 0;
      const total = era.items.length;
      const pct = Math.round((have/total)*100);
      progBar.style.width = pct + '%';

      const pairs = Object.entries(state.collected).filter(([k,s])=>s.size>0);
      if(pairs.length===0) collectedList.innerHTML = 'No items collected yet.';
      else collectedList.innerHTML = pairs.map(([k,s])=>{ const eraName = ERAS.find(e=>e.id===k).title; return `<div style="margin-bottom:6px"><strong>${eraName}</strong>: ${Array.from(s).join(' ')}</div>` }).join('');
    }

    function updateStatus(){
      const statuses = ERAS.map(e => `${e.title}: ${state.completed.has(e.id) ? '✅' : '❌'}`);
      statusListEl.innerHTML = statuses.join('<br/>');
      completedCountEl.textContent = state.completed.size;
    }

    // ---------- controls ----------
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(!state.currentEra) return;
      state.collected[state.currentEra.id] = new Set();
      state.completed.delete(state.currentEra.id);
      renderItems(state.currentEra);
      updateHUD();
      updateStatus();
    });

    document.getElementById('randomBtn').addEventListener('click', ()=>{
      const choice = ERAS[Math.floor(Math.random()*ERAS.length)]; selectEra(choice.id);
    });

    nextQuestionBtn.addEventListener('click', ()=>{
      state.currentQIndex++;
      nextQuestionBtn.classList.add('hidden');
      revealBtn.classList.remove('hidden');
      loadQuestion();
    });

    revealBtn.addEventListener('click', ()=>{
      if(state.currentEra && state.completed.has(state.currentEra.id)){
        // clear current era view so user can pick another
        eraIntro.classList.remove('hidden');
        questionSection.classList.add('hidden');
        currentEraTitle.textContent = 'Select an era to begin';
        currentEraDesc.textContent = 'Each era has a set of items to collect. Click them to progress.';
        itemsArea.innerHTML = '<div style="color:rgba(255,255,255,0.5); width:100%">Pick an era from above to start collecting.</div>';
        progBar.style.width = '0%';
        revealBtn.textContent = 'Reveal Surprise';
        if(state.completed.size === ERAS.length) showFinal();
      } else {
        // if not completed, reveal final anyway
        showFinal();
      }
    });

    restartBtn.addEventListener('click', ()=>{
      state.currentEra = null; state.collected = {}; state.currentQIndex = 0; state.completed.clear();
      finalReveal.classList.add('hidden'); document.getElementById('sideContent').classList.remove('hidden');
      eraIntro.classList.remove('hidden'); questionSection.classList.add('hidden');
      revealBtn.textContent = 'Reveal Surprise';
      currentEraTitle.textContent = 'Select an era to begin';
      currentEraDesc.textContent = 'Each era has a set of items to collect. Click them to progress.';
      itemsArea.innerHTML = '<div style="color:rgba(255,255,255,0.5); width:100%">Pick an era from above to start collecting.</div>';
      updateHUD(); updateStatus();
    });

    // ---------- final & confetti ----------
    function showFinal(){
      finalMessageText.textContent = '';
      // support newlines
      finalMessageText.innerHTML = finalMessage.replace(/\n/g, '<br/>');
      finalMessageTitle.textContent = `Happy Birthday, ${recipient.name}!`;
      document.getElementById('sideContent').classList.add('hidden');
      finalReveal.classList.remove('hidden');
      confettiBurst(160);
    }

    // lightweight confetti
    confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight;
    let confettiParticles = [];
    function confettiBurst(amount=80, colorHint){
      const colors = ['#ff7aa2','#ffd2e0','#ffe29f','#b9e3ff','#c7dcb6','#9bd3ff'];
      for(let i=0;i<amount;i++){
        confettiParticles.push({
          x: Math.random()*confettiCanvas.width,
          y: -20 - Math.random()*200,
          vx: (Math.random()-0.5)*8,
          vy: Math.random()*5+2,
          size: Math.random()*8+4,
          color: colorHint || colors[Math.floor(Math.random()*colors.length)],
          rot: Math.random()*360,
          life: 80 + Math.random()*60
        });
      }
      if(confettiParticles.length) runConfetti();
    }

    let confettiRunning = false;
    function runConfetti(){
      if(confettiRunning) return; confettiRunning = true;
      const ctx = confettiCanvas.getContext('2d');
      const loop = ()=>{
        ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
        confettiParticles.forEach(p=>{
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180);
          ctx.fillStyle = p.color; ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size*0.6);
          ctx.restore();
          p.x += p.vx; p.y += p.vy; p.vy += 0.12; p.rot += 4; p.life--;
        });
        confettiParticles = confettiParticles.filter(p=>p.life>0 && p.y < confettiCanvas.height+50);
        if(confettiParticles.length>0) requestAnimationFrame(loop); else confettiRunning=false;
      };
      requestAnimationFrame(loop);
    }

    window.addEventListener('resize', ()=>{ confettiCanvas.width = window.innerWidth; confettiCanvas.height = window.innerHeight; });

    // ---------- init ----------
    buildEraCards();
    updateHUD();
    updateStatus();

    // seed UI with first era selected
    selectEra(ERAS[0].id);
  </script>
</body>
</html>
